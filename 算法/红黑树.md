# 红黑树

## 性质

1. 红黑树的结点都是红色或者黑色
2. 根结点是黑色
3. 所有叶子都是黑色（这里的叶子结点是空结点）
4. 每个红色结点必须有两个黑色的子结点
5. 从任何一个节点到其每个叶子的所有简单路径都包含相同数目的黑色结点

---

* 性质1和性质3总是能够保持着；
* 性质4只有在这些情况下才会发生作用：
	* 增加红色结点
	* 将黑色结点重新绘制成红色结点
	* 旋转
* 性质5在这些情况下才会发生作用：
	* 增加黑色结点
	* 将红色结点重新绘制黑色结点
	* 旋转

举例：

![](http://odwv9d2u8.bkt.clouddn.com/17-5-21/336288-file_1495348485855_15f08.png)


## 插入

用BST的方法将结点插入，将该结点标记为红色的（因为如果标记为黑色，则会导致根结点到叶子结点的路径会多出一个黑结点，无法满足性质5，而且不容易进行调整），插入的情况包括下面几种：

1. 插入到一个空的树，插入结点则为根结点，只需要将红色结点重新转染成黑色结点来满足性质2；
2. 新结点的父结点为黑色，满足所有条件；
3. 新结点的父结点为红色，因为性质2和性质4，所以树必然有祖父结点，则又包括以下的情况：
	1. 父亲结点和兄弟结点均为红色，显然无法满足性质4，则将父亲结点和兄弟结点绘制成黑色，祖父结点设置成红色，但是仍然无法满足情况，考虑到祖父结点可能是根结点，则无法满足性质2，或者祖父结点的父结点是红色的，则无法满足性质4，这时需要将祖父结点作为新的结点来看待进行各种情况的判断，涉及到对祖父结点的递归；
	2. 父亲结点为红色同时兄弟结点为黑色或者从缺，这里又分为两种情况，新插入结点为父亲结点的左子结点和右子结点（假设其中父亲结点为祖父结点的左子结点），区别在于旋转的方向，显然，这棵树父亲结点既然为红色，那么其祖父结点则为黑色（性质4），不然无法满足前提。
		1. 新插入结点为父亲结点的左子结点，那么就构成了一个左左的情况，在之前平衡树中提到过，如果要将其进行平衡，则需要对父结点进行一次单右旋转，形成一个父亲结点为相对根结点，子结点和祖父结点为子结点的树，同时将父亲结点的红色改为黑色，祖父结点更改为红色，这下之前无法满足的性质4和性质5就满足了；
		2. 新插入结点为父亲结点的右子结点，那么就会构成一个左右的情况，在之前的平衡树也提到过要进行一次双旋转，先对新结点进行一次单左旋转，变成了左左的结构，再进行一次单右旋转，从而达到所有性质；
	3. 父亲结点是祖父结点的右结点，参考平衡树进行相应的操作，原理是一致的


## 删除

因为根据BST中的规则，选择该结点的左子树中最大值和右子树中最小值替代掉原本要删除的点的值，再将改点删掉即可，所以这里只会讨论那个删掉的点。

分为以下情况：

1. 删除结点的左右子结点均为空，则将其直接删除即可；
2. 删除结点的左右子结点不为空，则情况又分为好几种，删除结点为红色，子结点必然为黑色，用子结点进行替代即可；还有删除结点为黑色，而子结点为红色，则重新绘制子结点为黑色替代删除结点即可；还有删除结点为黑色，其子结点也为黑色，首先将子结点替换掉删除结点，这个则分为好几种情况：
	1. 子结点为新的根，此时只是将所有的路径中都去除一个黑色结点，所以依然保持平衡；
	2. 子结点的兄弟结点为红色，


假设N为要删除的点，P为N的父亲结点，S为N的兄弟结点，还有S左子结点为Sl和右子结点Sr，其中N为P的左子结点，S为右子结点；

大体上分好几种情况，P可能为红色或者黑色（两种），S可能为红色可能为黑色，Sl和Sr也可能为红色或者黑色，所以具体则分为以下几种：

1. P为黑色
	1. N为红色（其子结点必为黑色），S为黑色；
	2. N为黑色，S为红色（其子结点必为黑色）；
2. P为红色，则其S和N均为黑色
	1. Sl为红色，Sr为黑色；
	2. Sl为黑色，Sr为红色；
	3. Sl和Sr均为黑色；

先看1.a，用随便一个N的黑色子结点替代即可，没有造成失衡，符合所有性质；

再看1.b，此时对P进行一个左旋转，旋转后如下图，变成了以S为相对根结点，P为红色左子结点的树；
![](http://odwv9d2u8.bkt.clouddn.com/17-5-21/4624011-file_1495361356381_31f6.png)

再看2.a，要对S进行一个右旋转，此时就变成了2.c的情况，如下图：
![](http://odwv9d2u8.bkt.clouddn.com/17-5-21/28372718-file_1495362072281_17fe7.png)

再看2.b，对P进行一个左旋转，如下图，需要注意的是，在示意图中的白色节点可以是红色或黑色，但是在变换前后都必须指定相同的颜色；
![](http://odwv9d2u8.bkt.clouddn.com/17-5-21/88599288-file_1495362167693_163dc.png)

再看2.c，将S简单的进行重绘即可，但是导致了经过S的黑色结点的数量减少了一个，所以则需要通过递归处理；
![](http://odwv9d2u8.bkt.clouddn.com/17-5-21/83493056-file_1495364122278_7ac4.png)


